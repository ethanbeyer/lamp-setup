#!/bin/bash

if [[ $EUID -ne 0 ]]; then
   echo "mksite: need to run as root" 1>&2
   exit 1
fi

# Variables
BASENAME=$1
SA_DIR=/etc/apache2/sites-available

if [ $? != 0 ] ; then echo "Error: Run as sudo" ; exit 1; fi

# Script Runnnnn
echo "Website: ${BASENAME}"

echo "Making ${BASENAME} directory in /var/www"
mkdir -p /var/www/${BASENAME}/public_html

echo "Copying default template"
cp ~/configs/h5bp-apache2/vhosts/templates/example.com.conf ${SA_DIR}/${BASENAME}.conf

echo "Modifying default template"
sed -i "s/example.com/$BASENAME/g" ${SA_DIR}/${BASENAME}.conf

echo "Symlinking to sites-enabled"
sudo a2ensite ${BASENAME}.conf

echo "Restarting apache2"
sudo systemctl restart apache2

# echo "Generating an SSL Certificate"
# certbot --apache -d ${BASENAME}
# if [[ $WWW_FLAG == "1" ]]; then
#     certbot --apache -d www.${BASENAME}
# fi
